#!/usr/bin/env php
<?php
$filename = 'userstories';

$c = file_get_contents($filename);
$c = explode("\n\n", $c);

foreach ($c as $feature) {
    $block = '';

    $feature = explode("\n", $feature);

    $feature[0] = substr($feature[0], strlen('As a '));
    $feature[1] = substr($feature[1], strlen('I want to '));
    $feature[2] = substr($feature[2], strlen('So that I can '));

    array_walk($feature, 'trimitup');

    $block = '    In order to ' . $feature[2] . "\n";
    $block .= '    As a ' . $feature[0] . "\n";
    $block .= '    I want to ' . $feature[1] . "\n";

    echo "Story: \n";
    echo $block . "\n";
    while (file_exists($filename)) {
        $name = readline('Feature Name: ');
        $filename = $name . '.feature';
    }


    $out = 'Feature: ' . $name . "\n";
    $out .= $block;

    file_put_contents($filename, $out);
}

function trimitup(&$string) {
    $string = trim($string);
    $string = trim($string, '.');
    $string = trim($string);
}
