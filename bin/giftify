#!/bin/bash

STARTDIR=`pwd`
GIFTENSEN="$HOME/projects/gifstensen"
IMGLOC="$GIFTENSEN/public/images"

if [ ! -d "$IMGLOC" ]
then
    echo "Bailing out: $IMGLOC does not exist."
    exit 255
fi

if [ ! -f "$1" ]
then
    echo "File not found: $1"
    exit 1
fi

if [ `identify "$1" | cut -d" " -f2 | grep GIF | wc -l` -lt 2 ]
then
    echo "File doesn't look like a GIF: $1"
    exit 2
fi

if [ -z "$2" ]
then
    echo "No name detected for this gif. Please specify one."
    exit 3
fi

NEWPATH="$IMGLOC/$2.gif"
if [ -f "$NEWPATH" ]
then
    echo "Oops! File exists: $NEWPATH"
    exit 4
fi

cd $GIFTENSEN
git stash

cd $STARTDIR
cp $1 $NEWPATH

cd $GIFTENSEN
php reindex.php
php build.php
git add $NEWPATH
git add index.json
git commit -m "Adding $2"
git push origin master

git stash apply
giftensen
open 'http://giftensen.com/'

cd $STARTDIR
